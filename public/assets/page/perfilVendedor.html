<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Vendedor - Tienda Online</title>
    <link rel="stylesheet" href="../css/perfilVendedor.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <a href="#" class="logo">Panel de Vendedor</a>
            <div class="user-info">
                <span id="currentUserName">Cargando...</span>
                <span class="badge vendedor">VENDEDOR</span>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <!-- Sección de Bienvenida -->
            <div class="sidebar-section">
                <div class="profile-header">
                    <div class="avatar">
                        <i class="bi bi-person-circle"></i>
                    </div>
                    <h3 id="sidebarUserName">Vendedor</h3>
                    <p id="sidebarUserEmail" class="text-muted">cargando...</p>
                </div>
            </div>

            <!-- Menú Principal Vendedor -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">MENÚ PRINCIPAL</h3>
                <ul class="sidebar-menu">
                    <li class="menu-item">
                        <a href="#dashboard" class="menu-link active">
                            <i class="bi bi-speedometer2 menu-icon"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#productos" class="menu-link">
                            <i class="bi bi-box-seam menu-icon"></i>
                            Productos
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#ordenes" class="menu-link">
                            <i class="bi bi-cart-check menu-icon"></i>
                            Órdenes
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#mi-perfil" class="menu-link">
                            <i class="bi bi-person menu-icon"></i>
                            Mi Perfil
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Estadísticas Rápidas -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">ESTADÍSTICAS</h3>
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <i class="bi bi-box text-primary"></i>
                        <div>
                            <span class="stat-value" id="sidebarProductos">0</span>
                            <span class="stat-label">Productos</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="bi bi-cart text-success"></i>
                        <div>
                            <span class="stat-value" id="sidebarOrdenes">0</span>
                            <span class="stat-label">Órdenes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botones de Acción -->
            <div class="sidebar-section sidebar-actions">
                <button class="action-btn btn-store" onclick="irATienda()">
                    <i class="bi bi-shop menu-icon"></i>
                    Ver Tienda
                </button>
                <button class="action-btn btn-info" onclick="mostrarAyuda()">
                    <i class="bi bi-question-circle menu-icon"></i>
                    Ayuda
                </button>
                <button class="action-btn btn-logout" onclick="cerrarSesion()">
                    <i class="bi bi-box-arrow-right menu-icon"></i>
                    Cerrar Sesión
                </button>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main class="admin-main">
            <!-- Dashboard -->
            <section id="dashboard">
                <div class="welcome-section">
                    <h1 class="welcome-title" id="bienvenidoVendedor">Bienvenido, Vendedor</h1>
                    <p class="welcome-subtitle">Panel de control y gestión de productos</p>
                </div>
                
                <!-- Cards de Resumen -->
                <div class="dashboard-cards-row">
                    <div class="summary-card blue-card">
                        <div class="card-content">
                            <div class="card-icon">
                                <i class="bi bi-box"></i>
                            </div>
                            <div class="card-info">
                                <h3 class="card-title">Mis Productos</h3>
                                <p class="card-value" id="totalMisProductos">0</p>
                                <p class="card-subtitle">
                                    Activos: <span id="productosActivos">0</span> | Inactivos: <span id="productosInactivos">0</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card green-card">
                        <div class="card-content">
                            <div class="card-icon">
                                <i class="bi bi-cart"></i>
                            </div>
                            <div class="card-info">
                                <h3 class="card-title">Órdenes del Mes</h3>
                                <p class="card-value" id="ordenesMes">0</p>
                                <p class="card-subtitle">
                                    Total: $<span id="totalVentasMes">0</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card yellow-card">
                        <div class="card-content">
                            <div class="card-icon">
                                <i class="bi bi-bar-chart"></i>
                            </div>
                            <div class="card-info">
                                <h3 class="card-title">Rendimiento</h3>
                                <p class="card-value" id="tasaConversion">0%</p>
                                <p class="card-subtitle">
                                    Productos más vendidos: <span id="productoTop">0</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Acciones Rápidas -->
                <div class="quick-actions">
                    <h3 class="section-title">Acciones Rápidas</h3>
                    <div class="actions-grid">
                        <div class="action-card" onclick="navegarA('productos')">
                            <div class="action-icon">
                                <i class="bi bi-plus-circle"></i>
                            </div>
                            <h4>Agregar Producto</h4>
                            <p>Añade nuevos productos al catálogo</p>
                        </div>
                        
                        <div class="action-card" onclick="navegarA('ordenes')">
                            <div class="action-icon">
                                <i class="bi bi-eye"></i>
                            </div>
                            <h4>Ver Órdenes</h4>
                            <p>Revisa todas las órdenes de compra</p>
                        </div>
                        
                        <div class="action-card" onclick="navegarA('mi-perfil')">
                            <div class="action-icon">
                                <i class="bi bi-pencil-square"></i>
                            </div>
                            <h4>Editar Perfil</h4>
                            <p>Actualiza tu información personal</p>
                        </div>
                        
                        <div class="action-card" onclick="exportarReporte()">
                            <div class="action-icon">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            <h4>Generar Reporte</h4>
                            <p>Exporta reporte de ventas</p>
                        </div>
                    </div>
                </div>

                <!-- Últimas Órdenes -->
                <div class="recent-orders">
                    <div class="section-header">
                        <h3 class="section-title">Últimas Órdenes</h3>
                        <button class="btn btn-sm btn-secondary" onclick="navegarA('ordenes')">
                            Ver Todas
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>ID Orden</th>
                                    <th>Cliente</th>
                                    <th>Productos</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                </tr>
                            </thead>
                            <tbody id="ultimasOrdenes">
                                <tr>
                                    <td colspan="6" class="no-data">No hay órdenes recientes</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ==================== SECCIONES VENDEDOR ==================== -->

            <!-- Sección de Productos -->
            <section id="productos" style="display: none;">
                <div class="welcome-section">
                    <h2 class="welcome-title">Gestión de Productos</h2>
                    <p class="welcome-subtitle">Administra tus productos en el catálogo</p>
                </div>
                
                <div class="crud-container">
                    <div class="crud-header">
                        <h3>Mis Productos</h3>
                        <div class="crud-actions">
                            <div class="search-box">
                                <i class="bi bi-search"></i>
                                <input type="text" id="buscarProducto" placeholder="Buscar producto..." 
                                       onkeyup="filtrarProductosVendedor()">
                            </div>
                            <button class="btn btn-primary" onclick="mostrarModalProductoVendedor()">
                                <i class="bi bi-plus-circle"></i> Nuevo Producto
                            </button>
                            <button class="btn btn-secondary" onclick="cargarProductosVendedor()">
                                <i class="bi bi-arrow-repeat"></i> Actualizar
                            </button>
                        </div>
                    </div>

                    <!-- Filtros -->
                    <div class="filtros-section">
                        <select id="filtroEstadoProducto" onchange="filtrarProductosVendedor()">
                            <option value="">Todos los estados</option>
                            <option value="activo">Activos</option>
                            <option value="inactivo">Inactivos</option>
                        </select>
                        <select id="filtroCategoriaProducto" onchange="filtrarProductosVendedor()">
                            <option value="">Todas las categorías</option>
                        </select>
                    </div>

                    <div class="table-responsive">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>Imagen</th>
                                    <th>Nombre</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Categoría</th>
                                    <th>Estado</th>
                                    <th>Ventas</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productos-vendedor-tbody">
                                <tr>
                                    <td colspan="8" class="no-data">
                                        <i class="bi bi-box"></i>
                                        <p>No hay productos registrados</p>
                                        <button class="btn btn-primary btn-sm mt-2" onclick="mostrarModalProductoVendedor()">
                                            <i class="bi bi-plus-circle"></i> Agregar Primer Producto
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Sección de Órdenes -->
            <section id="ordenes" style="display: none;">
                <div class="welcome-section">
                    <h2 class="welcome-title">Órdenes de Compra</h2>
                    <p class="welcome-subtitle">Visualiza y gestiona las órdenes de tus productos</p>
                </div>
                
                <div class="crud-container">
                    <div class="crud-header">
                        <h3>Todas las Órdenes</h3>
                        <div class="crud-actions">
                            <div class="filtros">
                                <select id="filtroEstadoOrden" onchange="filtrarOrdenesVendedor()">
                                    <option value="">Todos los estados</option>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="procesando">Procesando</option>
                                    <option value="completado">Completado</option>
                                    <option value="cancelado">Cancelado</option>
                                </select>
                                <input type="date" id="fechaDesde" onchange="filtrarOrdenesVendedor()">
                                <input type="date" id="fechaHasta" onchange="filtrarOrdenesVendedor()">
                            </div>
                            <button class="btn btn-secondary" onclick="cargarOrdenesVendedor()">
                                <i class="bi bi-arrow-repeat"></i> Actualizar
                            </button>
                            <button class="btn btn-info" onclick="exportarOrdenes()">
                                <i class="bi bi-download"></i> Exportar
                            </button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>ID Orden</th>
                                    <th>Cliente</th>
                                    <th>Productos</th>
                                    <th>Cantidad</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ordenes-vendedor-tbody">
                                <tr>
                                    <td colspan="8" class="no-data">
                                        <i class="bi bi-cart"></i>
                                        <p>No hay órdenes registradas</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Sección Mi Perfil -->
            <section id="mi-perfil" style="display: none;">
                <div class="welcome-section">
                    <h2 class="welcome-title">Mi Perfil de Vendedor</h2>
                    <p class="welcome-subtitle">Gestiona tu información personal y credenciales</p>
                </div>
                
                <div class="crud-container">
                    <div class="profile-sections">
                        <!-- Información Personal -->
                        <div class="profile-section">
                            <h3 class="section-title">Información Personal</h3>
                            <form id="formPerfilVendedor" onsubmit="actualizarPerfilVendedor(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="profileNombre">Nombre Completo *</label>
                                        <input type="text" id="profileNombre" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="profileEmail">Email *</label>
                                        <input type="email" id="profileEmail" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="profileTelefono">Teléfono</label>
                                        <input type="tel" id="profileTelefono">
                                    </div>
                                    <div class="form-group">
                                        <label for="profileDireccion">Dirección</label>
                                        <input type="text" id="profileDireccion">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileBio">Biografía / Descripción</label>
                                    <textarea id="profileBio" rows="3" 
                                              placeholder="Describe tu experiencia o información relevante..."></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check-circle"></i> Guardar Cambios
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Configuración de Cuenta -->
                        <div class="profile-section">
                            <h3 class="section-title">Seguridad</h3>
                            <form id="formCambioClave" onsubmit="cambiarClaveVendedor(event)">
                                <div class="form-group">
                                    <label for="claveActual">Clave Actual *</label>
                                    <input type="password" id="claveActual" required>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="nuevaClave">Nueva Clave *</label>
                                        <input type="password" id="nuevaClave" required minlength="6">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmarClave">Confirmar Clave *</label>
                                        <input type="password" id="confirmarClave" required>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-warning">
                                        <i class="bi bi-key"></i> Cambiar Clave
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Información de Vendedor -->
                        <div class="profile-section">
                            <h3 class="section-title">Información de Vendedor</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">ID Vendedor:</span>
                                    <span class="info-value" id="infoVendedorId">Cargando...</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Fecha Registro:</span>
                                    <span class="info-value" id="infoFechaRegistro">Cargando...</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Estado:</span>
                                    <span class="badge activo" id="infoEstado">Activo</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Total Ventas:</span>
                                    <span class="info-value" id="infoTotalVentas">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ==================== MODALES VENDEDOR ==================== -->

    <!-- Modal para Productos (Vendedor) -->
    <div id="modalProductoVendedor" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('modalProductoVendedor')">&times;</span>
            <h3 id="modalProductoVendedorTitulo">Nuevo Producto</h3>
            <form id="formProductoVendedor" onsubmit="guardarProductoVendedor(event)">
                <input type="hidden" id="productoVendedorId">
                <input type="hidden" id="productoVendedorUid">
                
                <div class="form-group">
                    <label for="productoVendedorNombre">Nombre del Producto *</label>
                    <input type="text" id="productoVendedorNombre" required 
                           placeholder="Ej: Camiseta de algodón premium">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productoVendedorPrecio">Precio *</label>
                        <div class="input-with-icon">
                            <span class="input-icon">$</span>
                            <input type="number" id="productoVendedorPrecio" step="0.01" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productoVendedorStock">Stock Disponible *</label>
                        <input type="number" id="productoVendedorStock" min="0" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productoVendedorCategoria">Categoría *</label>
                    <select id="productoVendedorCategoria" required>
                        <option value="">Selecciona una categoría</option>
                        <option value="ropa">Ropa</option>
                        <option value="electronica">Electrónica</option>
                        <option value="hogar">Hogar</option>
                        <option value="deportes">Deportes</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="productoVendedorDescripcion">Descripción</label>
                    <textarea id="productoVendedorDescripcion" rows="3" 
                              placeholder="Describe las características del producto..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="productoVendedorImagen">URL de Imagen</label>
                    <input type="url" id="productoVendedorImagen" 
                           placeholder="https://ejemplo.com/imagen.jpg">
                    <small class="text-muted">Opcional. Deja en blanco para usar imagen por defecto.</small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="productoVendedorActivo" checked>
                        <span class="checkmark"></span>
                        Producto activo (visible en tienda)
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" 
                            onclick="cerrarModal('modalProductoVendedor')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalles Orden -->
    <div id="modalDetallesOrden" class="modal">
        <div class="modal-content modal-lg">
            <span class="close" onclick="cerrarModal('modalDetallesOrden')">&times;</span>
            <h3>Detalles de la Orden <span id="ordenDetalleId"></span></h3>
            
            <div class="orden-detalle">
                <!-- Información del Cliente -->
                <div class="detalle-section">
                    <h4><i class="bi bi-person"></i> Información del Cliente</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Nombre:</span>
                            <span class="info-value" id="detalleClienteNombre"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email:</span>
                            <span class="info-value" id="detalleClienteEmail"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Teléfono:</span>
                            <span class="info-value" id="detalleClienteTelefono"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Dirección:</span>
                            <span class="info-value" id="detalleClienteDireccion"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Productos de la Orden -->
                <div class="detalle-section">
                    <h4><i class="bi bi-box"></i> Productos Comprados</h4>
                    <div class="table-responsive">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Precio Unitario</th>
                                    <th>Cantidad</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody id="detalleOrdenProductos">
                                <!-- Productos se cargan aquí -->
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3" class="text-right"><strong>Total:</strong></td>
                                    <td><strong id="detalleOrdenTotal">$0</strong></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- Información de la Orden -->
                <div class="detalle-section">
                    <h4><i class="bi bi-info-circle"></i> Información de la Orden</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Estado:</span>
                            <span class="badge" id="detalleOrdenEstado"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fecha:</span>
                            <span class="info-value" id="detalleOrdenFecha"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Método de Pago:</span>
                            <span class="info-value" id="detalleOrdenPago"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Notas:</span>
                            <span class="info-value" id="detalleOrdenNotas"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" 
                        onclick="cerrarModal('modalDetallesOrden')">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="imprimirDetalleOrden()">
                    <i class="bi bi-printer"></i> Imprimir
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/perfilVendedor.js"></script>
    <script src="../js/logout.js"></script>
</body>
</html>