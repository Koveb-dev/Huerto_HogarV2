<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro | Huerto Hogar</title>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Font Awesome para ícono de hoja -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="../css/registro.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const usr = JSON.parse(localStorage.getItem('usuario'));
                if (usr && usr.id) {
                    window.location.href = 'catalogo.html';
                }
            } catch (_) {}
        });
    </script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <span>Huerto Hogar</span>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="../../index.html">Inicio</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                    <li><a href="catalogo.html">Catálogo</a></li>
                    <li><a href="ofertas.html">Ofertas</a></li>
                    <li><a href="carrito.html"><i class="bi bi-cart3"></i> Carrito(<span id="cart-count">0</span>)</a></li>
                    <li><a id="nav-login" href="login.html">Iniciar Sesión</a></li>
                    <li><a id="nav-logout" href="#" style="display:none;">Cerrar Sesión</a></li>
                    <li><span id="nav-username"></span></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="register-hero">
        <div class="container">
            <h1>Únete a Huerto Hogar</h1>
            <p>Crea tu cuenta y comienza a disfrutar de productos frescos directamente de la tierra a tu hogar</p>
        </div>
    </section>

    <!-- Register Section -->
    <section class="register-section">
        <div class="container">
            <div class="register-card animate fade-in-up">
                <div class="card-header">
                    <h2>Crear Cuenta</h2>
                    <p>Completa tus datos para registrarte</p>
                </div>

                <div class="card-body">
                    <form id="formUsuario">
                        <!-- RUN -->
                        <div class="form-group">
                            <label class="form-label" for="run">RUN (sin puntos ni guión)</label>
                            <input type="text" id="run" class="form-control" minlength="8" maxlength="9"
                                placeholder="Ej: 123456789" required pattern="[0-9]{8}[0-9K]"
                                title="8 dígitos seguidos de un dígito o K">
                            <small class="form-text">Ejemplo: 12345678-9 (ingresa sin guión)</small>
                        </div>

                        <!-- Nombre -->
                        <div class="form-group">
                            <label class="form-label" for="nombre">Nombre Completo</label>
                            <input type="text" id="nombre" class="form-control" maxlength="100"
                                placeholder="Ingresa tu nombre y apellido" required>
                        </div>

                        <!-- Correo -->
                        <div class="form-group">
                            <label class="form-label" for="correo">Correo Electrónico</label>
                            <input type="email" id="correo" class="form-control" maxlength="100"
                                placeholder="ejemplo@duoc.cl, @gmail.com o admin@tiendahuerto.cl" required>
                            <small class="form-text">Usaremos este correo para contactarte</small>
                        </div>

                        <!-- Contraseña -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="clave">Contraseña</label>
                                <input type="password" id="clave" class="form-control" minlength="4" maxlength="10"
                                    placeholder="Mínimo 4 caracteres" required>
                                <div class="password-strength">
                                    <div class="strength-bar" id="passwordStrength"></div>
                                </div>
                                <small class="form-text">Fortaleza: <span id="strengthText">Débil</span></small>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="confirmClave">Confirmar Contraseña</label>
                                <input type="password" id="confirmClave" class="form-control" minlength="4"
                                    maxlength="10" placeholder="Repite tu contraseña" required>
                                <small class="form-text" id="passwordMatch"></small>
                            </div>
                        </div>

                        <!-- Fecha de Nacimiento -->
                        <div class="form-group">
                            <label class="form-label" for="fecha">Fecha de Nacimiento</label>
                            <input type="date" id="fecha" class="form-control" required>
                            <small class="form-text" id="ageValidation"></small>
                        </div>

                        <!-- Rol -->
                        <div class="form-group">
                            <label class="form-label" for="rol">Rol</label>
                            <select id="rol" class="form-control" required>
                                <option value="">Selecciona tu rol</option>
                                <option value="cliente">Cliente</option>
                                <option value="vendedor">Vendedor</option>
                                <option value="admin">Administrador</option>
                            </select>
                            <small class="form-text">Elige cómo usarás la plataforma</small>
                        </div>

                        <!-- Términos y Condiciones -->
                        <div class="terms-group">
                            <input type="checkbox" id="terminos" required>
                            <label for="terminos">
                                Acepto los <a href="terminos.html" class="terms-link">Términos y Condiciones</a>
                                y la <a href="privacidad.html" class="terms-link">Política de Privacidad</a>
                            </label>
                        </div>

                        <!-- Botón de Registro -->
                        <button type="submit" class="btn-register">
                            <i class="bi bi-person-plus"></i> Crear Cuenta
                        </button>

                        <!-- Mensajes de estado -->
                        <div id="mensaje" class="mt-3"></div>

                        <!-- Progreso de registro (oculto inicialmente) -->
                        <div id="progressContainer" class="mt-3" style="display: none;">
                            <div class="progress">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                                    role="progressbar" style="width: 0%"></div>
                            </div>
                            <small id="progressText" class="text-center d-block mt-1"></small>
                        </div>
                    </form>

                    <!-- Enlace a login -->
                    <div class="login-footer mt-4">
                        <p>¿Ya tienes una cuenta? <a href="login.html" class="login-link">Inicia sesión aquí</a></p>
                    </div>
                </div>
            </div>

            <!-- Información adicional -->
            <div class="register-info mt-4">
                <div class="info-card">
                    <i class="bi bi-shield-check"></i>
                    <h4>Seguro y Confiable</h4>
                    <p>Tu información está protegida con encriptación de última generación</p>
                </div>
                <div class="info-card">
                    <i class="bi bi-truck"></i>
                    <h4>Envío Gratis</h4>
                    <p>En tu primer pedido recibes envío gratis a todo Santiago</p>
                </div>
                <div class="info-card">
                    <i class="bi bi-gift"></i>
                    <h4>Beneficios Exclusivos</h4>
                    <p>Accede a descuentos y ofertas especiales para miembros</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Huerto Hogar</h3>
                    <p><i class="bi bi-geo-alt"></i> Av. Principal 123, Santiago Centro</p>
                    <p><i class="bi bi-telephone"></i> +56 9 1234 5678</p>
                    <p><i class="bi bi-envelope"></i> contacto@huertohogar.cl</p>
                </div>
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <p><a href="../../index.html">Inicio</a></p>
                    <p><a href="nosotros.html">Nosotros</a></p>
                    <p><a href="catalogo.html">Catálogo</a></p>
                    <p><a href="contacto.html">Contacto</a></p>
                </div>
                <div class="footer-section">
                    <h3>Horario de Atención</h3>
                    <p>Lunes a Viernes: 9:00 - 19:00</p>
                    <p>Sábados: 10:00 - 14:00</p>
                    <p>Domingos: Cerrado</p>
                </div>
                <div class="footer-section">
                    <h3>Síguenos</h3>
                    <div class="social-icons">
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                        <a href="#"><i class="bi bi-tiktok"></i></a>
                        <a href="#"><i class="bi bi-youtube"></i></a>
                    </div>
                    <p class="mt-3">Suscríbete a nuestro newsletter</p>
                    <div class="newsletter-form">
                        <input type="email" placeholder="Tu correo" class="form-control-sm">
                        <button class="btn btn-sm btn-light">Suscribir</button>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Huerto Hogar. Todos los derechos reservados. | <a href="privacidad.html">Política de
                        Privacidad</a> | <a href="terminos.html">Términos de Uso</a></p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../js/script.js"></script>
    <script>
        // Script adicional para mejoras en la UI
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Página de registro cargada');

            // Animación para la tarjeta
            const card = document.querySelector('.register-card');
            setTimeout(() => {
                card.classList.add('animate');
            }, 100);

            // Validación en tiempo real de contraseña
            const claveInput = document.getElementById('clave');
            const strengthBar = document.getElementById('passwordStrength');
            const strengthText = document.getElementById('strengthText');

            if (claveInput && strengthBar && strengthText) {
                claveInput.addEventListener('input', function () {
                    const password = this.value;
                    let strength = 0;
                    let text = 'Débil';
                    let color = '#ff4444';

                    if (password.length >= 4) strength += 25;
                    if (password.length >= 6) strength += 25;
                    if (/[A-Z]/.test(password)) strength += 25;
                    if (/[0-9]/.test(password)) strength += 25;

                    strengthBar.style.width = strength + '%';

                    if (strength < 50) {
                        text = 'Débil';
                        color = '#ff4444';
                    } else if (strength < 75) {
                        text = 'Media';
                        color = '#ffbb33';
                    } else {
                        text = 'Fuerte';
                        color = '#00C851';
                    }

                    strengthBar.style.backgroundColor = color;
                    strengthText.textContent = text;
                    strengthText.style.color = color;
                    strengthText.style.fontWeight = 'bold';
                });
            }

            // Validación en tiempo real de confirmación de contraseña
            const confirmClaveInput = document.getElementById('confirmClave');
            const passwordMatchText = document.getElementById('passwordMatch');

            if (confirmClaveInput && passwordMatchText) {
                confirmClaveInput.addEventListener('input', function () {
                    const clave = document.getElementById('clave').value;
                    const confirmClave = this.value;

                    if (confirmClave) {
                        if (clave === confirmClave) {
                            this.style.borderColor = '#00C851';
                            this.style.boxShadow = '0 0 0 3px rgba(0, 200, 81, 0.1)';
                            passwordMatchText.textContent = '✓ Las contraseñas coinciden';
                            passwordMatchText.style.color = '#00C851';
                        } else {
                            this.style.borderColor = '#ff4444';
                            this.style.boxShadow = '0 0 0 3px rgba(255, 68, 68, 0.1)';
                            passwordMatchText.textContent = '✗ Las contraseñas no coinciden';
                            passwordMatchText.style.color = '#ff4444';
                        }
                    } else {
                        this.style.borderColor = '#e1e1e1';
                        this.style.boxShadow = 'none';
                        passwordMatchText.textContent = '';
                    }
                });
            }

            // Validación en tiempo real de edad
            const fechaInput = document.getElementById('fecha');
            const ageValidationText = document.getElementById('ageValidation');

            if (fechaInput && ageValidationText) {
                // Establecer fecha máxima (hoy) y mínima (120 años atrás)
                const hoy = new Date();
                const maxDate = new Date(hoy.getFullYear() - 18, hoy.getMonth(), hoy.getDate());
                const minDate = new Date(hoy.getFullYear() - 120, hoy.getMonth(), hoy.getDate());

                fechaInput.max = maxDate.toISOString().split('T')[0];
                fechaInput.min = minDate.toISOString().split('T')[0];

                fechaInput.addEventListener('change', function () {
                    if (this.value) {
                        const fechaNacimiento = new Date(this.value);
                        const edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
                        const mes = hoy.getMonth() - fechaNacimiento.getMonth();

                        if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNacimiento.getDate())) {
                            edad--;
                        }

                        if (edad >= 18) {
                            this.style.borderColor = '#00C851';
                            this.style.boxShadow = '0 0 0 3px rgba(0, 200, 81, 0.1)';
                            ageValidationText.textContent = `✓ Edad válida: ${edad} años`;
                            ageValidationText.style.color = '#00C851';
                        } else {
                            this.style.borderColor = '#ff4444';
                            this.style.boxShadow = '0 0 0 3px rgba(255, 68, 68, 0.1)';
                            ageValidationText.textContent = `✗ Debes ser mayor de 18 años (tienes ${edad} años)`;
                            ageValidationText.style.color = '#ff4444';
                        }
                    }
                });
            }

            // Mostrar progreso durante el registro
            window.mostrarProgreso = function (etapa, porcentaje) {
                const progressContainer = document.getElementById('progressContainer');
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');

                if (progressContainer && progressBar && progressText) {
                    progressContainer.style.display = 'block';
                    progressBar.style.width = porcentaje + '%';
                    progressText.textContent = etapa;

                    if (porcentaje >= 100) {
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                        }, 1000);
                    }
                }
            };

            // Verificar si hay parámetros de error en la URL
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');
            if (error) {
                const mensajeDiv = document.getElementById('mensaje');
                if (mensajeDiv) {
                    mensajeDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i>
                            ${decodeURIComponent(error)}
                        </div>
                    `;
                }
            }
        });
    </script>
</body>

</html>